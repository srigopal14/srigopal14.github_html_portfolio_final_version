<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DIY Bubble Game | Sriya Gopalan</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/p5.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    body { margin: 0; font-family: 'Inter', sans-serif; background: #1a1a2e; }
    #game-canvas canvas { display: block; margin: 0 auto; border-radius: 1rem; }
    footer { text-align: center; color: white; margin-top: 1rem; }
  </style>
</head>
<body>

<div id="game-canvas"></div>
<footer>Â© 2025 Sriya Gopalan</footer>

<script>
let objects = [], explosions = [], pops = [];
let score=0, totalObjects=15, winScore=50, lives=5;
let gameWon=false, gameLost=false, timer=60, MAX_TIME=60;
let shakeAmount=0, shakeDuration=0, gameStarted=false;

function setup() {
  let canvas = createCanvas(700, 450);
  canvas.parent('game-canvas');
}

function draw() {
  // Gradient background
  for(let y=0;y<height;y++){
    stroke(26,26,46 + y*0.1, 255);
    line(0,y,width,y);
  }

  if(!gameStarted){
    drawButton(width/2, height/2, 180, 70, "PLAY");
    return;
  }

  if(!gameWon && !gameLost){
    timer -= deltaTime/1000;
    if(timer<=0) gameLost=true;
  }

  push();
  if(shakeDuration>0){
    translate(random(-shakeAmount, shakeAmount), random(-shakeAmount, shakeAmount));
    shakeDuration--;
  }

  if(gameWon){ displayWinScreen(); pop(); return; }
  if(gameLost){ displayLoseScreen(); pop(); return; }

  drawHUD();
  
  for(let obj of objects){ obj.move(); obj.show(); }
  for(let i=explosions.length-1;i>=0;i--){ if(explosions[i].update()) explosions.splice(i,1); }
  for(let i=pops.length-1;i>=0;i--){ if(pops[i].update()) pops.splice(i,1); }

  pop();
}

function mousePressed(){
  if(!gameStarted){
    if(mouseX>width/2-90 && mouseX<width/2+90 && mouseY>height/2-35 && mouseY<height/2+35){
      gameStarted=true; startGame();
    }
    return;
  }

  if(gameWon || gameLost){
    if(mouseX>width/2-90 && mouseX<width/2+90 && mouseY>height/2+50 && mouseY<height/2+90){
      startGame();
    }
    return;
  }

  for(let i=objects.length-1;i>=0;i--){
    if(objects[i].isClicked(mouseX, mouseY)){
      if(objects[i].isBomb){
        explosions.push(new Explosion(objects[i].x, objects[i].y));
        lives--; score = max(0, score-5);
        shakeAmount=8; shakeDuration=15;
        if(lives<=0) gameLost=true;
      } else {
        pops.push(new PopEffect(objects[i].x, objects[i].y));
        score++; if(score>=winScore) gameWon=true;
      }
      objects.splice(i,1); objects.push(new GameObject());
    }
  }
}

function startGame(){
  objects=[]; explosions=[]; pops=[];
  score=0; lives=5; timer=MAX_TIME;
  gameWon=false; gameLost=false; shakeAmount=0; shakeDuration=0;
  for(let i=0;i<totalObjects;i++) objects.push(new GameObject());
}

function drawButton(x,y,w,h,label){
  push();
  rectMode(CENTER);
  fill(0,150,255);
  stroke(255); strokeWeight(2);
  rect(x,y,w,h,15);
  fill(255); noStroke();
  textAlign(CENTER, CENTER);
  textSize(28); text(label,x,y);
  pop();
}

function drawHUD(){
  fill(0,0,0,120); noStroke(); rect(10,10,150,70,10);
  fill(255); textSize(18); textAlign(LEFT);
  text("Score: "+score,20,35);
  text("Lives: "+lives,20,60);
  text("Time: "+Math.ceil(timer),20,85);
}

function displayWinScreen(){
  push();
  fill(0,200,100,200); rectMode(CENTER); rect(width/2,height/2,500,250,20);
  fill(255); textAlign(CENTER, CENTER); textSize(28);
  text(`YOU WIN!\nScore: ${score}\nTime Left: ${Math.ceil(timer)}s`, width/2, height/2-30);
  drawButton(width/2,height/2+70,180,40,"PLAY AGAIN");
  pop();
}

function displayLoseScreen(){
  push();
  fill(255,70,70,200); rectMode(CENTER); rect(width/2,height/2,500,250,20);
  fill(255); textAlign(CENTER, CENTER); textSize(24);
  text(`YOU LOSE!\nScore: ${score}\nTime Left: ${Math.ceil(timer)}s`, width/2, height/2-30);
  drawButton(width/2,height/2+70,180,40,"PLAY AGAIN");
  pop();
}

class GameObject{
  constructor(){ this.reset(); }
  move(){ this.y -= this.speed; if(this.y<-this.r) this.reset(); this.x+=sin(frameCount*0.05)*0.5; }
  show(){
    noStroke();
    if(this.isBomb){
      fill(this.col); ellipse(this.x,this.y,this.r*2);
      stroke(255,0,0,150); strokeWeight(3); ellipse(this.x,this.y,this.r*2.5);
      noStroke();
    } else {
      fill(this.col); ellipse(this.x,this.y,this.r*2);
      if(this.isBonus){ fill(255); textAlign(CENTER,CENTER); text("+",this.x,this.y); }
    }
  }
  isClicked(px,py){ let radius = this.isBonus ? this.r*1.5 : this.r; return dist(px,py,this.x,this.y)<radius; }
  reset(){
    this.r=random(20,35);
    this.x=random(this.r,width-this.r);
    this.y=random(height+this.r,height+200);
    this.speed=random(1,2.5);
    this.isBomb=random(1)<0.15;
    this.isBonus=false;
    this.col = this.isBomb? color(255,50,50):color(random(100,255),random(100,255),255,180);
  }
}

class Explosion{ constructor(x,y){ this.x=x; this.y=y; this.frames=0; this.maxFrames=12; }
update(){ this.frames++; let s=this.frames*5; noStroke(); fill(255,150,0,200-this.frames*15); ellipse(this.x,this.y,s); fill(255,50,0,200-this.frames*20); ellipse(this.x,this.y,s*0.7); return this.frames>this.maxFrames; } }

class PopEffect{ constructor(x,y){ this.x=x; this.y=y; this.frames=0; this.maxFrames=10; }
update(){ this.frames++; let s=this.frames*3; noFill(); stroke(255,255-this.frames*25); strokeWeight(2); ellipse(this.x,this.y,s); return this.frames>this.maxFrames; } }
</script>

</body>
</html>
